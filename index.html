<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Asset Manager Pro</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ˜</text></svg>">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        :root { --primary: #24292f; --accent: #0969da; --danger: #cf222e; --bg: #f6f8fa; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: none; }
        .panel { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: #fff; border: 1px solid #d0d7de; border-radius: 12px; overflow: hidden; }
        .preview-box { height: 180px; background: #eee; }
        model-viewer { width: 100%; height: 100%; }
        .card-info { padding: 15px; }
        .btn { padding: 8px; border: 1px solid #d0d7de; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 5px; font-weight: bold; }
        .btn-up { background: var(--primary); color: white; border: none; }
        .login-screen { position: fixed; inset: 0; background: var(--primary); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    </style>
</head>
<body>

<div id="login" class="login-screen">
    <div style="background:white; padding:40px; border-radius:12px; text-align:center;">
        <h2>Asset Manager Login</h2>
        <input type="password" id="pass-input" placeholder="Passcode" style="padding:10px; border:1px solid #ddd; width:200px;">
        <button onclick="checkPass()" class="btn btn-up" style="margin-top:10px;">Login</button>
    </div>
</div>

<div class="container" id="main-content">
    <h1>Asset Manager Pro</h1>
    <div class="panel">
        <h3 style="margin-top:0">GitHubã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
        <input type="file" id="gh-file">
        <button class="btn btn-up" onclick="uploadToGithub()" id="up-btn" style="width:auto; padding:10px 30px;">å®Ÿè¡Œ</button>
    </div>
    <div id="drive-section">
        <h3>Google Drive Asset (Temporary)</h3>
        <div class="grid" id="drive-grid"></div>
    </div>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbwS7UBlHaklPdrP2uXZk07JEnPaCVsBuVKZTGusAT9Y3JSZGrsx6dfwRu4y_n4gDt_5RQ/exec";

async function checkPass() {
    const pass = document.getElementById('pass-input').value;
    const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "auth", pass: pass }) });
    const result = await res.json();
    if (result.success) {
        document.getElementById('login').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        loadDriveAssets();
    } else { alert("ä¸æ­£ãªãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™"); }
}

async function loadDriveAssets() {
    const grid = document.getElementById('drive-grid');
    grid.innerHTML = "èª­ã¿è¾¼ã¿ä¸­...";
    const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "list_drive" }) });
    const files = await res.json();
    
    grid.innerHTML = "";
    files.forEach(file => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <div class="preview-box">Driveãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸å¯</div>
            <div class="card-info">
                <strong>${file.name}</strong>
                <button class="btn btn-danger" onclick="deleteFile('${file.id}')" style="color:red">å‰Šé™¤</button>
            </div>
        `;
        grid.appendChild(card);
    });
}

async function uploadToGithub() {
    const fileEl = document.getElementById('gh-file');
    if (fileEl.files.length === 0) return alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");
    const file = fileEl.files[0];
    const btn = document.getElementById('up-btn');
    btn.innerText = "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­..."; btn.disabled = true;

    const reader = new FileReader();
    reader.onload = async () => {
        const base64 = reader.result.split(',')[1];
        const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "github_upload", filename: file.name, base64: base64 }) });
        const result = await res.json();
        if (result.content) { alert("GitHubã¸ä¿å­˜æˆåŠŸï¼"); location.reload(); }
        else { alert("å¤±æ•—: " + result.message); }
        btn.innerText = "å®Ÿè¡Œ"; btn.disabled = false;
    };
    reader.readAsDataURL(file);
}

async function deleteFile(id) {
    if(!confirm("Driveã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
    const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "delete", id: id }) });
    const result = await res.json();
    if(result.status === "success") { alert("å‰Šé™¤ã—ã¾ã—ãŸ"); loadDriveAssets(); }
}
</script>
</body>
</html>
